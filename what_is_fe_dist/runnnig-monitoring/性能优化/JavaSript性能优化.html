<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JavaSript 性能优化 | What is FE</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="构建自己的系统的 Web 前端知识体系">
    
    <link rel="preload" href="/assets/css/0.styles.41761744.css" as="style"><link rel="preload" href="/assets/js/app.03ee6b57.js" as="script"><link rel="preload" href="/assets/js/2.5e2d37c1.js" as="script"><link rel="preload" href="/assets/js/43.1696fde3.js" as="script"><link rel="preload" href="/assets/js/3.b304fdc1.js" as="script"><link rel="prefetch" href="/assets/js/10.9fc866c3.js"><link rel="prefetch" href="/assets/js/11.6cec0877.js"><link rel="prefetch" href="/assets/js/12.2e394fe4.js"><link rel="prefetch" href="/assets/js/13.8d280b6b.js"><link rel="prefetch" href="/assets/js/14.bf3acadd.js"><link rel="prefetch" href="/assets/js/15.e9a85e67.js"><link rel="prefetch" href="/assets/js/16.9739f4e9.js"><link rel="prefetch" href="/assets/js/17.9dae5907.js"><link rel="prefetch" href="/assets/js/18.77de363b.js"><link rel="prefetch" href="/assets/js/19.f0db7d2f.js"><link rel="prefetch" href="/assets/js/20.55b96468.js"><link rel="prefetch" href="/assets/js/21.b0c634aa.js"><link rel="prefetch" href="/assets/js/22.910496c8.js"><link rel="prefetch" href="/assets/js/23.f2019cb9.js"><link rel="prefetch" href="/assets/js/24.4f0acc54.js"><link rel="prefetch" href="/assets/js/25.40572b65.js"><link rel="prefetch" href="/assets/js/26.5fb1bbfe.js"><link rel="prefetch" href="/assets/js/27.bd1cfbc8.js"><link rel="prefetch" href="/assets/js/28.3980a94c.js"><link rel="prefetch" href="/assets/js/29.f914a730.js"><link rel="prefetch" href="/assets/js/30.d7197eb2.js"><link rel="prefetch" href="/assets/js/31.7dc8e5b6.js"><link rel="prefetch" href="/assets/js/32.04e8cba2.js"><link rel="prefetch" href="/assets/js/33.2721e7a4.js"><link rel="prefetch" href="/assets/js/34.0c377332.js"><link rel="prefetch" href="/assets/js/35.5cd4c3e5.js"><link rel="prefetch" href="/assets/js/36.456bf31e.js"><link rel="prefetch" href="/assets/js/37.65fbca64.js"><link rel="prefetch" href="/assets/js/38.7f956c5f.js"><link rel="prefetch" href="/assets/js/39.52f803a0.js"><link rel="prefetch" href="/assets/js/4.e1b57234.js"><link rel="prefetch" href="/assets/js/40.caaf397a.js"><link rel="prefetch" href="/assets/js/41.ba2dff08.js"><link rel="prefetch" href="/assets/js/42.eefc6b66.js"><link rel="prefetch" href="/assets/js/44.cabec37b.js"><link rel="prefetch" href="/assets/js/45.206095b2.js"><link rel="prefetch" href="/assets/js/46.c58bbd34.js"><link rel="prefetch" href="/assets/js/47.3965d35f.js"><link rel="prefetch" href="/assets/js/48.95db7add.js"><link rel="prefetch" href="/assets/js/49.29ff02c2.js"><link rel="prefetch" href="/assets/js/5.a6acc31c.js"><link rel="prefetch" href="/assets/js/50.4c232c9a.js"><link rel="prefetch" href="/assets/js/51.2b2783b8.js"><link rel="prefetch" href="/assets/js/52.2f4e30a9.js"><link rel="prefetch" href="/assets/js/53.b42b3f2a.js"><link rel="prefetch" href="/assets/js/54.5db10089.js"><link rel="prefetch" href="/assets/js/55.d26298dd.js"><link rel="prefetch" href="/assets/js/56.c32a8f9f.js"><link rel="prefetch" href="/assets/js/57.011ad986.js"><link rel="prefetch" href="/assets/js/58.338446eb.js"><link rel="prefetch" href="/assets/js/59.89aaa122.js"><link rel="prefetch" href="/assets/js/6.56200eb6.js"><link rel="prefetch" href="/assets/js/60.fd85c133.js"><link rel="prefetch" href="/assets/js/61.dd40a9a7.js"><link rel="prefetch" href="/assets/js/62.433bac9b.js"><link rel="prefetch" href="/assets/js/63.a260258b.js"><link rel="prefetch" href="/assets/js/64.5f297d68.js"><link rel="prefetch" href="/assets/js/65.7e3561ca.js"><link rel="prefetch" href="/assets/js/7.ab8ffd39.js"><link rel="prefetch" href="/assets/js/8.f847aa7a.js"><link rel="prefetch" href="/assets/js/9.cf5a45fa.js">
    <link rel="stylesheet" href="/assets/css/0.styles.41761744.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">What is FE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming-basics/编程模式/函数式编程.html" class="nav-link">
  编程基础
</a></div><div class="nav-item"><a href="/syntax&amp;API/HTML/关于HTML.html" class="nav-link">
  语法和API
</a></div><div class="nav-item"><a href="/network/" class="nav-link">
  网络和通讯
</a></div><div class="nav-item"><a href="/development-process/Git/git命令.html" class="nav-link">
  开发流程
</a></div><div class="nav-item"><a href="/engineering/webpack/webpack基础学习.html" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/runnnig-monitoring/安全/CSRF.html" class="nav-link">
  运行与监控
</a></div><div class="nav-item"><a href="/framework/React/关于react-hook.html" class="nav-link">
  前端框架
</a></div><div class="nav-item"><a href="/tool&amp;plugin/cross-env/关于cross-env.html" class="nav-link">
  常用工具与插件
</a></div><div class="nav-item"><a href="/server/" class="nav-link">
  服务器端
</a></div><div class="nav-item"><a href="/more/" class="nav-link">
  技术广度
</a></div><div class="nav-item"><a href="https://github.com/licop/What_is_FE" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming-basics/编程模式/函数式编程.html" class="nav-link">
  编程基础
</a></div><div class="nav-item"><a href="/syntax&amp;API/HTML/关于HTML.html" class="nav-link">
  语法和API
</a></div><div class="nav-item"><a href="/network/" class="nav-link">
  网络和通讯
</a></div><div class="nav-item"><a href="/development-process/Git/git命令.html" class="nav-link">
  开发流程
</a></div><div class="nav-item"><a href="/engineering/webpack/webpack基础学习.html" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/runnnig-monitoring/安全/CSRF.html" class="nav-link">
  运行与监控
</a></div><div class="nav-item"><a href="/framework/React/关于react-hook.html" class="nav-link">
  前端框架
</a></div><div class="nav-item"><a href="/tool&amp;plugin/cross-env/关于cross-env.html" class="nav-link">
  常用工具与插件
</a></div><div class="nav-item"><a href="/server/" class="nav-link">
  服务器端
</a></div><div class="nav-item"><a href="/more/" class="nav-link">
  技术广度
</a></div><div class="nav-item"><a href="https://github.com/licop/What_is_FE" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>安全</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/runnnig-monitoring/安全/CSRF.html" class="sidebar-link">CSRF</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>性能优化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/runnnig-monitoring/性能优化/JavaSript性能优化.html" class="active sidebar-link">JavaSript 性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/runnnig-monitoring/性能优化/JavaSript性能优化.html#javacript-内存管理" class="sidebar-link">Javacript 内存管理</a></li><li class="sidebar-sub-header"><a href="/runnnig-monitoring/性能优化/JavaSript性能优化.html#javacript-垃圾回收" class="sidebar-link">Javacript 垃圾回收</a></li><li class="sidebar-sub-header"><a href="/runnnig-monitoring/性能优化/JavaSript性能优化.html#gc-算法" class="sidebar-link">GC 算法</a></li><li class="sidebar-sub-header"><a href="/runnnig-monitoring/性能优化/JavaSript性能优化.html#v8-引擎" class="sidebar-link">V8 引擎</a></li><li class="sidebar-sub-header"><a href="/runnnig-monitoring/性能优化/JavaSript性能优化.html#performance-工具" class="sidebar-link">Performance 工具</a></li><li class="sidebar-sub-header"><a href="/runnnig-monitoring/性能优化/JavaSript性能优化.html#内存问题" class="sidebar-link">内存问题</a></li><li class="sidebar-sub-header"><a href="/runnnig-monitoring/性能优化/JavaSript性能优化.html#js-代码优化" class="sidebar-link">JS 代码优化</a></li><li class="sidebar-sub-header"><a href="/runnnig-monitoring/性能优化/JavaSript性能优化.html#更多参考" class="sidebar-link">更多参考</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="javasript-性能优化"><a href="#javasript-性能优化" class="header-anchor">#</a> JavaSript 性能优化</h1> <h2 id="javacript-内存管理"><a href="#javacript-内存管理" class="header-anchor">#</a> Javacript 内存管理</h2> <ul><li><strong>内存</strong>: 有可读写的单元组成，表示一片可操作的空间</li> <li><strong>内存管理</strong>： 开发者主动申请空间，使用空间，释放空间</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 申请</span>
<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 使用</span>
obj<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&quot;lg&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 释放</span>
obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="javacript-垃圾回收"><a href="#javacript-垃圾回收" class="header-anchor">#</a> Javacript 垃圾回收</h2> <p>JavaScript 中<strong>内存管理</strong>是自动的，而且是不可见的。我们创建基本类型、对象、函数……所有这些都需要内存。</p> <h3 id="什么时候产生垃圾"><a href="#什么时候产生垃圾" class="header-anchor">#</a> 什么时候产生垃圾</h3> <ul><li>对象不在被引用时</li> <li>对象不能从跟上访问到</li></ul> <h3 id="可达对象"><a href="#可达对象" class="header-anchor">#</a> 可达对象</h3> <ul><li>可以被访问到的对象就是<strong>可达对象</strong>（引用，作用域链）</li> <li>可达的标准就是从<strong>跟</strong>上出发是否能够被找到</li> <li>JavaScript 中的<strong>根</strong>就可以理解为是<strong>全局变量对象</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">objGroup</span><span class="token punctuation">(</span><span class="token parameter">obj1<span class="token punctuation">,</span> obj2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  obj1<span class="token punctuation">.</span>next <span class="token operator">=</span> obj2<span class="token punctuation">;</span>
  obj2<span class="token punctuation">.</span>prev <span class="token operator">=</span> obj1<span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    o1<span class="token operator">:</span> obj1<span class="token punctuation">,</span>
    o2<span class="token operator">:</span> obj2<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token function">objGroup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;obj1&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&quot;obj2&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用图示对上面代码进行说明，obj1 和 obj2 进行相互的引用，目前所有对象都是可达对象。</p> <p><img src="/running-monitoring/%E5%8F%AF%E8%BE%BE%E5%AF%B9%E8%B1%A11.png" alt=""></p> <p>当把 obj 下的 o1 和 o2 的 prev 删除掉，此时我们无法访问到 obj1,这时可以 obj1 可以被认为是<strong>垃圾</strong></p> <p><img src="/running-monitoring/%E5%8F%AF%E8%BE%BE%E5%AF%B9%E8%B1%A12.png" alt=""></p> <p>JavaScript 引擎中有一个后台进程称为垃圾回收器，它监视所有对象，并删除那些不可访问的对象。</p> <h2 id="gc-算法"><a href="#gc-算法" class="header-anchor">#</a> GC 算法</h2> <p>GC 就是<strong>垃圾回收机制</strong>的简写，GC 可以找到内存中的垃圾、并释放和回收空间</p> <p><strong>GC 里的垃圾是什么？</strong></p> <ul><li>程序中不再需要使用的对象</li> <li>程序中不能在访问的对象</li></ul> <p><strong>什么是 GC 算法？</strong></p> <ul><li>GC 是一种机制，垃圾回收完成具体的工作</li> <li>工作内容就是查找垃圾释放空间、回收空间</li> <li>算法就是工作是查找和回收所遵循的原则</li></ul> <h3 id="引用计数"><a href="#引用计数" class="header-anchor">#</a> 引用计数</h3> <p>这是最初级的垃圾收集算法。此算法把“对象是否不再需要”简化定义为“对象有没有其他对象引用到它”。如果没有引用指向该对象（零引用），对象将被垃圾回收机制回收。</p> <p><strong>核心思想</strong></p> <p>设置引用数， 判断当前引用数是否为 0</p> <p><strong>示例</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token punctuation">{</span>
    b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 两个对象被创建，一个作为另一个的属性被引用，另一个被分配给变量o</span>
<span class="token comment">// 很显然，没有一个可以被垃圾收集</span>

<span class="token keyword">var</span> o2 <span class="token operator">=</span> o<span class="token punctuation">;</span> <span class="token comment">// o2变量是第二个对“这个对象”的引用</span>

o <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 现在，“这个对象”只有一个o2变量的引用了，“这个对象”的原始引用o已经没有</span>

<span class="token keyword">var</span> oa <span class="token operator">=</span> o2<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 引用“这个对象”的a属性</span>
<span class="token comment">// 现在，“这个对象”有两个引用了，一个是o2，一个是oa</span>

o2 <span class="token operator">=</span> <span class="token string">&quot;yo&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 虽然最初的对象现在已经是零引用了，可以被垃圾回收了</span>
<span class="token comment">// 但是它的属性a的对象还在被oa引用，所以还不能回收</span>

oa <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// a属性的那个对象现在也是零引用了</span>
<span class="token comment">// 它可以被垃圾回收了</span>
</code></pre></div><p><strong>优点</strong></p> <ul><li>可以及时回收垃圾对象</li> <li>减少程序卡顿</li></ul> <p><strong>缺点</strong></p> <ul><li>无法回收循环引用的对象</li> <li>资源消耗比较大</li></ul> <h3 id="标记清除"><a href="#标记清除" class="header-anchor">#</a> 标记清除</h3> <p>这个算法假定设置一个叫做**根（root）**的对象（在 Javascript 里，根是全局对象）。垃圾回收器将定期从根开始，找所有从根开始引用的对象，然后找这些对象引用的对象……从根开始，垃圾回收器将找到所有可以获得的对象和收集所有不能获得的对象。</p> <p>如图所示，a1 和 b1 相互引用，但是无法从<strong>跟</strong>上访问到，为不可达对象，所以被当做垃圾处理。</p> <p><img src="/running-monitoring/%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4.png" alt=""></p> <p><strong>核心思想</strong></p> <p>核心思想：分<strong>标记</strong>和<strong>清除</strong>两个阶段，第一阶段遍历所有对象找标记活动对象，遍历所有对象清除没有标记对象。</p> <p><strong>优点</strong></p> <ul><li>可以回收循环引用的对象</li></ul> <p><strong>缺点</strong></p> <ul><li>容易产生碎片化空间，浪费空间</li> <li>不会立即回收垃圾对象</li></ul> <h3 id="标记整理"><a href="#标记整理" class="header-anchor">#</a> 标记整理</h3> <p>标记整理算法是<strong>标记清除</strong>的增强，会在清除阶段之前执行整理，移动对象位置。</p> <p><strong>优点</strong></p> <ul><li>减少碎片化空间</li></ul> <p><strong>缺点</strong></p> <ul><li>不会立即回收垃圾对象</li></ul> <h2 id="v8-引擎"><a href="#v8-引擎" class="header-anchor">#</a> V8 引擎</h2> <p>V8 引擎是一款主流的采用即时编译的 JavScript 执行引擎</p> <h3 id="v8-内存设限"><a href="#v8-内存设限" class="header-anchor">#</a> V8 内存设限</h3> <p>由于起初只是作为浏览器端 JavaScript 的执行环境，且 JavaScript 是单线程的，在浏览器端我们很少会遇到使用大量内存的场景，所以 V8 直接对内存进行了限制。64 位操作系统默认使用 1.4G，32 位操作系统默认使用 0.7G。</p> <h3 id="v8-垃圾回收策略"><a href="#v8-垃圾回收策略" class="header-anchor">#</a> V8 垃圾回收策略</h3> <p>V8 采用了一种分代回收的策略，将内存分为两个生代：新生代（new generation）和老生代（old generation）, 针对不同对象采用不同算法。可以减少了每次需遍历的对象，从而减少每次垃圾回收的耗时。</p> <p><img src="/running-monitoring/v8%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6.png" alt=""></p> <p>v8 内部内存被分为两个区域，左侧存储老生代对象，右侧存储老生代对象
<img src="/running-monitoring/v8%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D.png" alt=""></p> <h3 id="新生代垃圾回收"><a href="#新生代垃圾回收" class="header-anchor">#</a> 新生代垃圾回收</h3> <p><strong>新生代</strong>指的是存活时间较短的对象</p> <p>回收过程采用复制算法和标记整理，新生代内存区分为两个等大小的空间 From（使用空间）和 To（空闲空间）</p> <p>活动对象存储在 From 空间，当垃圾回收时使用标记整理后将活动对象拷贝至 To，然后 From 和 To 交换空间完成释放</p> <p>新生代区域垃圾回收使用空间换时间。</p> <p>拷贝的过程中可能存在<strong>晋升</strong>，<strong>晋升</strong>就是将新生代对象移动至老年代</p> <p><strong>晋升条件</strong></p> <ul><li>一轮 GC 还存活的新生态对象需要晋升</li> <li>To 空间的使用率超过 25%</li></ul> <h3 id="老生代垃圾回收"><a href="#老生代垃圾回收" class="header-anchor">#</a> 老生代垃圾回收</h3> <p><strong>老生代</strong>指的是存活时间较长的对象，例如全局对象和闭包里的数据。</p> <p>回收过程采用标记清除、标记整理、增量标记算法，首先使用<strong>标记清除</strong>完成垃圾空间的回收，然后在<strong>晋升</strong>阶段如果空间不足采用<strong>标记整理</strong>进行空间优化，采用<strong>增量标记</strong>进行效率的优化</p> <p><strong>增量标记如何优化垃圾回收</strong></p> <p>原本需要一次性遍历堆内存的操作改为增量标记的方式，先标记堆内存中的一部分对象，然后暂停，将执行权重新交给 JS 主线程，待主线程任务执行完毕后再从原来暂停标记的地方继续标记，直到标记完整个堆内存。这个理念其实有点像<strong>React</strong>框架中的<strong>Fiber</strong>架构，只有在浏览器的空闲时间才会去遍历<strong>Fiber</strong> Tree 执行对应的任务，否则延迟执行，尽可能少地影响主线程的任务，避免应用卡顿，提升应用性能。</p> <p><img src="/running-monitoring/%E5%A2%9E%E9%87%8F%E6%A0%87%E8%AE%B0.png" alt=""></p> <h2 id="performance-工具"><a href="#performance-工具" class="header-anchor">#</a> Performance 工具</h2> <p>使用 Chrome DevTools 的 <strong>performance</strong> 面板可以记录和分析页面在<strong>运行时</strong>的所有活动,通过 Performance 可以时刻监控内存。</p> <p>可以参考<a href="https://zhuanlan.zhihu.com/p/29879682" target="_blank" rel="noopener noreferrer">Chrome Devtool Performance 使用指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="内存问题"><a href="#内存问题" class="header-anchor">#</a> 内存问题</h2> <h3 id="外在表现"><a href="#外在表现" class="header-anchor">#</a> 外在表现</h3> <ul><li>页面出现延迟加载或经常性暂停</li> <li>页面持续性出现糟糕的性能</li> <li>页面的性能随时间延长越来越差（内存泄露）</li></ul> <h3 id="界定内存问题的标准"><a href="#界定内存问题的标准" class="header-anchor">#</a> 界定内存问题的标准</h3> <ul><li><strong>内存泄漏（memory leak）</strong>: 不再用到的内存，没有及时释放，内存使用持续升高
<img src="/running-monitoring/%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2.png" alt=""></li> <li><strong>内存膨胀</strong>: 在多数设备上都存在性能问题</li> <li><strong>频繁垃圾回收</strong>: 通过内存变化图进行分析</li></ul> <h3 id="监控内存的几种方式"><a href="#监控内存的几种方式" class="header-anchor">#</a> 监控内存的几种方式</h3> <ul><li>浏览器的任务管理器</li> <li>Timeline 时序图记录</li> <li>堆快照查找分离 DOM</li></ul> <h3 id="任务管理器监控内存"><a href="#任务管理器监控内存" class="header-anchor">#</a> 任务管理器监控内存</h3> <p>可以通过判断内存是否增长来判断是否有问题，不能定位问题。</p> <h3 id="timeline-时序图记录"><a href="#timeline-时序图记录" class="header-anchor">#</a> Timeline 时序图记录</h3> <p>使用 Performance 工具，勾选内存选项，来分析内存的实时走向
<img src="/running-monitoring/timeline.png" alt=""></p> <h3 id="堆快照查找分离-dom"><a href="#堆快照查找分离-dom" class="header-anchor">#</a> 堆快照查找分离 DOM</h3> <p><strong>什么是分离 DOM</strong></p> <p><strong>分离 DOM</strong>从 DOM 树上分离，但是在 JS 代码中还有引用，在界面上看不见，在内存上占据空间。</p> <p>以下代码 tmpEle 为<strong>分离 DOM</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> tmpEle<span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> ul <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;ul&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> li <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ul<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>li<span class="token punctuation">)</span><span class="token punctuation">;</span>

    tmpEle <span class="token operator">=</span> ul<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>使用开发者工具 内存， 勾选堆快照
<img src="/running-monitoring/%E5%A0%86%E5%BF%AB%E7%85%A7.png" alt=""></p> <p>搜索 detached 查看是否有分离 dom
<img src="/running-monitoring/%E5%A0%86%E5%BF%AB%E7%85%A7%E5%88%86%E7%A6%BBdom.png" alt=""></p> <h2 id="js-代码优化"><a href="#js-代码优化" class="header-anchor">#</a> JS 代码优化</h2> <h3 id="慎用全局变量"><a href="#慎用全局变量" class="header-anchor">#</a> 慎用全局变量</h3> <p><strong>全局变量</strong>定义在全局的执行上下文，是所有作用域链的顶端</p> <p><strong>为什么要慎用？</strong></p> <ul><li>全局执行上下文一直存在于上下文执行栈，直到程序退出，不利于垃圾回收</li> <li>如果某个局部作用域出现了同名变量则会遮蔽或污染全局</li></ul> <p>使用 <a href="https://jsbench.me/" target="_blank" rel="noopener noreferrer">jsbench<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对代码的效率进行对比</p> <p><img src="/running-monitoring/jsbench1.png" alt=""></p> <h3 id="通过原型对象添加附加方法"><a href="#通过原型对象添加附加方法" class="header-anchor">#</a> 通过原型对象添加附加方法</h3> <p><img src="/running-monitoring/jsbench2.png" alt=""></p> <h3 id="避开闭包陷阱"><a href="#避开闭包陷阱" class="header-anchor">#</a> 避开闭包陷阱</h3> <p><strong>闭包特点</strong></p> <ul><li>外部具有指向内部的引用</li> <li>在外部作用域访问内部作用域的数据</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 此时的a引用了内部的fn</span>
<span class="token comment">// a在调用时外部作用域访问了内部的a</span>
<span class="token comment">// 发生了闭包</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">&quot;licop&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>闭包是一个强大的语法，闭包使用不当很容易造成出现内存泄露，不要为了闭包而闭包。</p> <h3 id="避免属性访问方法使用"><a href="#避免属性访问方法使用" class="header-anchor">#</a> 避免属性访问方法使用</h3> <p><img src="/running-monitoring/jsbench3.png" alt=""></p> <h3 id="for-循环优化"><a href="#for-循环优化" class="header-anchor">#</a> for 循环优化</h3> <p><strong>对数组的长度进行提前保存, 减少循环体中的活动</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 更优</span>
<span class="token keyword">let</span> <span class="token keyword">let</span> <span class="token operator">=</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>对比遍历方式</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> arrList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 最快</span>
arrList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 相对较慢</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> arrList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arrList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 很快</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> arrList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arrList<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="优化节点操作"><a href="#优化节点操作" class="header-anchor">#</a> 优化节点操作</h3> <p>通过文档碎片优化节点添加</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> oP <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  oP<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> i<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>oP<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 相对较快</span>
<span class="token keyword">const</span> fragEle <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> oP <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  oP<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> i<span class="token punctuation">;</span>
  fragEle<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>oP<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>fragEle<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>通过克隆节点优化节点操作</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> oP <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  oP<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> i<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>oP<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 相对较快</span>
<span class="token keyword">var</span> oldP <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;box1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> newP <span class="token operator">=</span> oldP<span class="token punctuation">.</span><span class="token function">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  newP<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> i<span class="token punctuation">;</span>
  document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>newP<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="直接量替换-new-object-构造式"><a href="#直接量替换-new-object-构造式" class="header-anchor">#</a> 直接量替换 new object 构造式</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 较快</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// 较慢</span>
<span class="token keyword">var</span> a1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
a1<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
a1<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="减少判断层级"><a href="#减少判断层级" class="header-anchor">#</a> 减少判断层级</h3> <p>尽量减少 if 语句的层级嵌套，可以使用提前 return 方法将嵌套减少掉</p> <h3 id="减少作用链查找层级"><a href="#减少作用链查找层级" class="header-anchor">#</a> 减少作用链查找层级</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;licop&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  name <span class="token operator">=</span> <span class="token string">&quot;licop1&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 这里的name属于全局的</span>

  <span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 更优</span>
<span class="token keyword">var</span> name <span class="token operator">=</span> <span class="token string">&quot;licop&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token string">&quot;licop1&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> age <span class="token operator">=</span> <span class="token number">18</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="减少数据读取次数"><a href="#减少数据读取次数" class="header-anchor">#</a> 减少数据读取次数</h3> <p>把频繁使用的值提前缓存变量，使用空间换时间</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> oBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;skip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">hasEle</span><span class="token punctuation">(</span><span class="token parameter">ele<span class="token punctuation">,</span> cls</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> ele<span class="token punctuation">.</span>className <span class="token operator">===</span> cls<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">hasEle</span><span class="token punctuation">(</span>oBox<span class="token punctuation">,</span> <span class="token string">&quot;skip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 更优</span>
<span class="token keyword">var</span> oBox <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;skip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">hasEle</span><span class="token punctuation">(</span><span class="token parameter">ele<span class="token punctuation">,</span> cls</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> clsName <span class="token operator">=</span> ele<span class="token punctuation">.</span>className<span class="token punctuation">;</span>
  <span class="token keyword">return</span> clsName <span class="token operator">===</span> cls<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">hasEle</span><span class="token punctuation">(</span>oBox<span class="token punctuation">,</span> <span class="token string">&quot;skip&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="减少声明及语句数"><a href="#减少声明及语句数" class="header-anchor">#</a> 减少声明及语句数</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> test <span class="token operator">=</span> <span class="token punctuation">(</span>ele<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> w <span class="token operator">=</span> ele<span class="token punctuation">.</span>offsetWidth<span class="token punctuation">;</span>
  <span class="token keyword">let</span> h <span class="token operator">=</span> ele<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span>
  <span class="token keyword">return</span> w <span class="token operator">*</span> h<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 更优</span>
<span class="token keyword">var</span> test <span class="token operator">=</span> <span class="token punctuation">(</span>ele<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> ele<span class="token punctuation">.</span>offsetWidth <span class="token operator">*</span> ele<span class="token punctuation">.</span>offsetHeight<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="惰性函数与性能"><a href="#惰性函数与性能" class="header-anchor">#</a> 惰性函数与性能</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">addEvent</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>attachEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">&quot;on&quot;</span> <span class="token operator">+</span> type<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">[</span><span class="token string">&quot;on&quot;</span> <span class="token operator">+</span> type<span class="token punctuation">]</span> <span class="token operator">=</span> fn<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 更优</span>
<span class="token keyword">function</span> <span class="token function">addEvent</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> type<span class="token punctuation">,</span> fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    addEvent <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> fn<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">.</span>attachEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    addEvent <span class="token operator">=</span> obj<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token string">&quot;on&quot;</span> <span class="token operator">+</span> type<span class="token punctuation">,</span> fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    addEvent <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token string">&quot;on&quot;</span> <span class="token operator">+</span> type<span class="token punctuation">]</span> <span class="token operator">=</span> fn<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> addEvent<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">addEvent</span><span class="token punctuation">(</span>btn<span class="token punctuation">,</span> <span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="更多参考"><a href="#更多参考" class="header-anchor">#</a> 更多参考</h2> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Memory_Management" target="_blank" rel="noopener noreferrer">MDN 内存管理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://developers.google.com/web/tools/chrome-devtools/evaluate-performance?hl=zh-cn" target="_blank" rel="noopener noreferrer">chrome Performance 的使用<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/29879682" target="_blank" rel="noopener noreferrer">Chrome Devtool Performance 使用指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://blog.csdn.net/rexuejava/article/details/108112129?utm_source=app" target="_blank" rel="noopener noreferrer">从 4 个面试题了解「浏览器的垃圾回收」<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/runnnig-monitoring/安全/CSRF.html" class="prev">
        CSRF
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.03ee6b57.js" defer></script><script src="/assets/js/2.5e2d37c1.js" defer></script><script src="/assets/js/43.1696fde3.js" defer></script><script src="/assets/js/3.b304fdc1.js" defer></script>
  </body>
</html>
