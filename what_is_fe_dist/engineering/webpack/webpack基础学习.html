<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack 基础学习 | What is FE</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="构建自己的系统的 Web 前端知识体系">
    
    <link rel="preload" href="/assets/css/0.styles.05e426fd.css" as="style"><link rel="preload" href="/assets/js/app.23d3122b.js" as="script"><link rel="preload" href="/assets/js/2.5e2d37c1.js" as="script"><link rel="preload" href="/assets/js/23.9da4a7d3.js" as="script"><link rel="preload" href="/assets/js/3.b304fdc1.js" as="script"><link rel="prefetch" href="/assets/js/10.a37a353b.js"><link rel="prefetch" href="/assets/js/11.d1b90c3d.js"><link rel="prefetch" href="/assets/js/12.d3bf7b11.js"><link rel="prefetch" href="/assets/js/13.6f6b4894.js"><link rel="prefetch" href="/assets/js/14.2c89a43b.js"><link rel="prefetch" href="/assets/js/15.565302df.js"><link rel="prefetch" href="/assets/js/16.863ec29e.js"><link rel="prefetch" href="/assets/js/17.81c8a830.js"><link rel="prefetch" href="/assets/js/18.4e8004a4.js"><link rel="prefetch" href="/assets/js/19.04ae3cb6.js"><link rel="prefetch" href="/assets/js/20.43106a54.js"><link rel="prefetch" href="/assets/js/21.56a2417a.js"><link rel="prefetch" href="/assets/js/22.d0c70b78.js"><link rel="prefetch" href="/assets/js/24.6382844b.js"><link rel="prefetch" href="/assets/js/25.33b58a3b.js"><link rel="prefetch" href="/assets/js/26.f5dfaeb5.js"><link rel="prefetch" href="/assets/js/27.a01f0f1c.js"><link rel="prefetch" href="/assets/js/28.8f4ee848.js"><link rel="prefetch" href="/assets/js/29.14745b03.js"><link rel="prefetch" href="/assets/js/30.339e63b1.js"><link rel="prefetch" href="/assets/js/31.299a0ec5.js"><link rel="prefetch" href="/assets/js/32.36a9b7fc.js"><link rel="prefetch" href="/assets/js/33.02f2ea3b.js"><link rel="prefetch" href="/assets/js/34.8c2fd8ae.js"><link rel="prefetch" href="/assets/js/35.e1131b1f.js"><link rel="prefetch" href="/assets/js/36.ca800f3d.js"><link rel="prefetch" href="/assets/js/37.834c20f9.js"><link rel="prefetch" href="/assets/js/38.f0c65a45.js"><link rel="prefetch" href="/assets/js/39.4d09d993.js"><link rel="prefetch" href="/assets/js/4.61dc0fce.js"><link rel="prefetch" href="/assets/js/40.f50d8b03.js"><link rel="prefetch" href="/assets/js/41.e634a1d4.js"><link rel="prefetch" href="/assets/js/42.4409db03.js"><link rel="prefetch" href="/assets/js/43.eb927c4f.js"><link rel="prefetch" href="/assets/js/44.c2c8ac29.js"><link rel="prefetch" href="/assets/js/45.8c89abb2.js"><link rel="prefetch" href="/assets/js/46.1f598736.js"><link rel="prefetch" href="/assets/js/47.0dc0c336.js"><link rel="prefetch" href="/assets/js/48.7311c091.js"><link rel="prefetch" href="/assets/js/49.0590a5ee.js"><link rel="prefetch" href="/assets/js/5.a6acc31c.js"><link rel="prefetch" href="/assets/js/50.5e6aa420.js"><link rel="prefetch" href="/assets/js/51.daaa3ea1.js"><link rel="prefetch" href="/assets/js/52.3be16e9a.js"><link rel="prefetch" href="/assets/js/53.f73c6710.js"><link rel="prefetch" href="/assets/js/54.a7d47983.js"><link rel="prefetch" href="/assets/js/55.5de6d42b.js"><link rel="prefetch" href="/assets/js/56.23b3eed4.js"><link rel="prefetch" href="/assets/js/57.a3fcd7a7.js"><link rel="prefetch" href="/assets/js/58.bceb7f62.js"><link rel="prefetch" href="/assets/js/59.1755e44b.js"><link rel="prefetch" href="/assets/js/6.56200eb6.js"><link rel="prefetch" href="/assets/js/60.0bd98a77.js"><link rel="prefetch" href="/assets/js/61.f0cd536c.js"><link rel="prefetch" href="/assets/js/62.1d73b33b.js"><link rel="prefetch" href="/assets/js/63.e2f2897f.js"><link rel="prefetch" href="/assets/js/64.8f52af13.js"><link rel="prefetch" href="/assets/js/65.d3483f2c.js"><link rel="prefetch" href="/assets/js/66.142ba4e5.js"><link rel="prefetch" href="/assets/js/67.a5d671a7.js"><link rel="prefetch" href="/assets/js/68.f6e3aa17.js"><link rel="prefetch" href="/assets/js/69.fdf1350c.js"><link rel="prefetch" href="/assets/js/7.ab8ffd39.js"><link rel="prefetch" href="/assets/js/70.9dff3efb.js"><link rel="prefetch" href="/assets/js/71.262665e8.js"><link rel="prefetch" href="/assets/js/72.73136398.js"><link rel="prefetch" href="/assets/js/73.e20e1cda.js"><link rel="prefetch" href="/assets/js/74.2de2dab9.js"><link rel="prefetch" href="/assets/js/75.d033acb2.js"><link rel="prefetch" href="/assets/js/76.5f13e879.js"><link rel="prefetch" href="/assets/js/77.6652698b.js"><link rel="prefetch" href="/assets/js/78.afe723ed.js"><link rel="prefetch" href="/assets/js/79.3bb9a95d.js"><link rel="prefetch" href="/assets/js/8.f847aa7a.js"><link rel="prefetch" href="/assets/js/80.84bf0a56.js"><link rel="prefetch" href="/assets/js/81.88c56010.js"><link rel="prefetch" href="/assets/js/82.2b75bb62.js"><link rel="prefetch" href="/assets/js/83.3230acf5.js"><link rel="prefetch" href="/assets/js/84.02f48b8c.js"><link rel="prefetch" href="/assets/js/85.05feeacd.js"><link rel="prefetch" href="/assets/js/86.5abf208e.js"><link rel="prefetch" href="/assets/js/87.cec0c2e6.js"><link rel="prefetch" href="/assets/js/88.e62b7e95.js"><link rel="prefetch" href="/assets/js/89.708bba5c.js"><link rel="prefetch" href="/assets/js/9.93fa1ba1.js"><link rel="prefetch" href="/assets/js/90.f79f6a80.js"><link rel="prefetch" href="/assets/js/91.98970e22.js"><link rel="prefetch" href="/assets/js/92.de5dd0bd.js"><link rel="prefetch" href="/assets/js/93.1b91999e.js"><link rel="prefetch" href="/assets/js/94.7d7076a6.js"><link rel="prefetch" href="/assets/js/95.b2b0edd4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.05e426fd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">What is FE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming-basics/编程模式/函数式编程.html" class="nav-link">
  编程基础
</a></div><div class="nav-item"><a href="/syntax&amp;API/HTML/关于HTML.html" class="nav-link">
  语法和API
</a></div><div class="nav-item"><a href="/network/" class="nav-link">
  网络和通讯
</a></div><div class="nav-item"><a href="/development-process/Git/git命令.html" class="nav-link">
  开发流程
</a></div><div class="nav-item"><a href="/engineering/webpack/webpack基础学习.html" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/runnnig-monitoring/安全/CSRF.html" class="nav-link">
  运行与监控
</a></div><div class="nav-item"><a href="/framework/React/React基础学习.html" class="nav-link">
  前端框架
</a></div><div class="nav-item"><a href="/tool&amp;method/常用方法代码总结/封装fetch方法.html" class="nav-link">
  常用工具与方法
</a></div><div class="nav-item"><a href="/server/nodejs/Nodejs学习笔记.html" class="nav-link">
  服务器端
</a></div><div class="nav-item"><a href="/more/" class="nav-link">
  技术广度
</a></div><div class="nav-item"><a href="https://github.com/licop/What_is_FE" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming-basics/编程模式/函数式编程.html" class="nav-link">
  编程基础
</a></div><div class="nav-item"><a href="/syntax&amp;API/HTML/关于HTML.html" class="nav-link">
  语法和API
</a></div><div class="nav-item"><a href="/network/" class="nav-link">
  网络和通讯
</a></div><div class="nav-item"><a href="/development-process/Git/git命令.html" class="nav-link">
  开发流程
</a></div><div class="nav-item"><a href="/engineering/webpack/webpack基础学习.html" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/runnnig-monitoring/安全/CSRF.html" class="nav-link">
  运行与监控
</a></div><div class="nav-item"><a href="/framework/React/React基础学习.html" class="nav-link">
  前端框架
</a></div><div class="nav-item"><a href="/tool&amp;method/常用方法代码总结/封装fetch方法.html" class="nav-link">
  常用工具与方法
</a></div><div class="nav-item"><a href="/server/nodejs/Nodejs学习笔记.html" class="nav-link">
  服务器端
</a></div><div class="nav-item"><a href="/more/" class="nav-link">
  技术广度
</a></div><div class="nav-item"><a href="https://github.com/licop/What_is_FE" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前端工程化</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/engineering/前端工程化/模块化.html" class="sidebar-link">关于模块化</a></li><li><a href="/engineering/前端工程化/规范化.html" class="sidebar-link">关于规范化</a></li><li><a href="/engineering/前端工程化/前端工程化概述.html" class="sidebar-link">前端工程化概述</a></li><li><a href="/engineering/前端工程化/脚手架工具.html" class="sidebar-link">脚手架工具</a></li><li><a href="/engineering/前端工程化/自动化构建.html" class="sidebar-link">自动化构建</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>webpack</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/engineering/webpack/webpack基础学习.html" class="active sidebar-link">webpack 基础学习</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/engineering/webpack/webpack基础学习.html#什么是-webpack" class="sidebar-link">什么是 webpack</a></li><li class="sidebar-sub-header"><a href="/engineering/webpack/webpack基础学习.html#webpack-安装" class="sidebar-link">webpack 安装</a></li><li class="sidebar-sub-header"><a href="/engineering/webpack/webpack基础学习.html#webpack-配置" class="sidebar-link">webpack 配置</a></li><li class="sidebar-sub-header"><a href="/engineering/webpack/webpack基础学习.html#mode" class="sidebar-link">mode</a></li><li class="sidebar-sub-header"><a href="/engineering/webpack/webpack基础学习.html#loader" class="sidebar-link">loader</a></li><li class="sidebar-sub-header"><a href="/engineering/webpack/webpack基础学习.html#plugins" class="sidebar-link">plugins</a></li><li class="sidebar-sub-header"><a href="/engineering/webpack/webpack基础学习.html#entry-output" class="sidebar-link">entry &amp; output</a></li><li class="sidebar-sub-header"><a href="/engineering/webpack/webpack基础学习.html#devtool" class="sidebar-link">Devtool</a></li><li class="sidebar-sub-header"><a href="/engineering/webpack/webpack基础学习.html#devserver" class="sidebar-link">devServer</a></li><li class="sidebar-sub-header"><a href="/engineering/webpack/webpack基础学习.html#解析-resolve" class="sidebar-link">解析 resolve</a></li><li class="sidebar-sub-header"><a href="/engineering/webpack/webpack基础学习.html#热模块替换-hmr" class="sidebar-link">热模块替换 HMR</a></li><li class="sidebar-sub-header"><a href="/engineering/webpack/webpack基础学习.html#babel" class="sidebar-link">babel</a></li></ul></li><li><a href="/engineering/webpack/webpack高级概念.html" class="sidebar-link">webpack 高级概念</a></li><li><a href="/engineering/webpack/webpack实例应用.html" class="sidebar-link">webpack 实例应用</a></li><li><a href="/engineering/webpack/webpack性能优化.html" class="sidebar-link">webpack 性能优化</a></li><li><a href="/engineering/webpack/编一个webapck loader和pugin.html" class="sidebar-link">编写一个简单的 loader 和 plugin</a></li><li><a href="/engineering/webpack/bundler源码编写.html" class="sidebar-link">简易的 bundler 源码编写</a></li><li><a href="/engineering/webpack/createReactApp wepack配置分析.html" class="sidebar-link">creactReactApp webapck 配置分析</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>babel</span> <!----></p> <!----></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>rollup</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/engineering/rollup/rollup.html" class="sidebar-link">rollup</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="webpack-基础学习"><a href="#webpack-基础学习" class="header-anchor">#</a> webpack 基础学习</h1> <h2 id="什么是-webpack"><a href="#什么是-webpack" class="header-anchor">#</a> 什么是 webpack</h2> <p><strong>核心定义:</strong> webpack 是一个静态模块打包工具(module bundler),可以解决前端整体的模块化，并不单指 JavaScript 模块化。</p> <p><strong>模块 module:</strong> 在模块化编程中，开发者将程序分解为功能离散的 chunk，并称之<em>模块</em>。</p> <h3 id="webpack-天生支持的模块"><a href="#webpack-天生支持的模块" class="header-anchor">#</a> webpack 天生支持的模块</h3> <ul><li>ES Module import 语句</li> <li>commonJS <code>require()</code> 语句</li> <li>AMD <code>define</code>和<code>require</code> 语句</li> <li>样式代码 stylesheet url(）</li> <li>HTML <img src=""> 文件中的图片链接</li> <li>WebAssembly 模块</li></ul> <h3 id="通过-loader-支持的模块"><a href="#通过-loader-支持的模块" class="header-anchor">#</a> 通过 <em>loader</em> 支持的模块</h3> <ul><li>CoffeeScript</li> <li>TypeScript</li> <li>ESNext (Babel)</li> <li>Sass</li> <li>Less</li> <li>Stylus</li> <li>Elm</li></ul> <blockquote><p>当使用 webpack 打包 ES6 模块时，webpack 可以识别<code>import</code>和<code>export</code>语法，但是注意，如果使用其他的 ES6+ 特性，仍然需要引入 babel。</p></blockquote> <p><strong>核心工作原理</strong></p> <p>在我们的项目中会散落着各种各样的代码和资源文件，webpack 会根据配置找到文件作为打包入口，一般情况下都会是一个 javascript 文件，然后会找到代码中 import 和 require 之类的语句，解析推断出文件所依赖的资源模块，然后解析每个资源模块对应的依赖，最后形成整个项目所有用到文件之间的依赖树，webpack 会递归这个依赖树，然后找到每个节点所对应的资源文件，根据配置文件中的 rules 属性找到模块所对应的加载器，交给对应的加载器加载这个模块，最后会把加载到的结果放到 bundle.js 中，完成这个<strong>打包</strong>过程。</p> <p><img src="/engineering/webpack_bundle.png" alt=""></p> <h2 id="webpack-安装"><a href="#webpack-安装" class="header-anchor">#</a> webpack 安装</h2> <ul><li>npm install webpack webpack-cli -g</li></ul> <h2 id="webpack-配置"><a href="#webpack-配置" class="header-anchor">#</a> webpack 配置</h2> <p>webpack4.0 以后得版本会支持零配置的方式直接启动打包，整个打包过程会按照约定将<code>src/index.js</code>作为打包的入口，打包的结果会存放在<code>dist/main.js</code>中。但是很多时候我们需要自定义配置，这个时候我们需要再<code>webpack.config.js</code>中添加配置项来自定义我们的打包。</p> <h2 id="mode"><a href="#mode" class="header-anchor">#</a> mode</h2> <ul><li>提供 <code>mode</code> 配置选项，告知 webpack 使用相应模式的内置优化。</li></ul> <p>string = 'mode': 'none' | 'development' | 'production'</p> <ol><li>生产模式下，Webpack 会自动优化打包结果；</li> <li>开发模式下，Webpack 会自动优化打包速度，添加一些调试过程中的辅助；</li> <li>None 模式下，Webpack 就是运行最原始的打包，不做任何额外处理；</li></ol> <ul><li>使用<code>production</code>会对代码进行压缩，使用<code>development</code>不会</li></ul> <h2 id="loader"><a href="#loader" class="header-anchor">#</a> loader</h2> <p><code>loader</code>是 webpack 的核心特性,<code>loader</code>负责资源文件从输入到输出的转换, 对于同一资源可以依次使用多个 <code>loader</code>。借助于 <code>loader</code> 就可以加载任何类型的资源 <code>webpack</code> 不能识别非 js 格式文件， 只能使用 <code>loader</code> 用于对模块的源代码进行转换。webpack 根据正则表达式，来确定应该查找哪些文件，并将其提供给指定的 <code>loader</code>。</p> <p>webpack 支持使用 <code>loader</code> 对文件进行预处理。你可以构建包括 JavaScript 在内的任何静态资源。并且可以使用 Node.js 轻松编写自己的 <code>loader</code>。</p> <p>如果一个静态文件不是 js 格式，则需要判断文件的结尾后缀，使用对应的文件格式的<code>loader</code>。</p> <p><strong>常用配置方式</strong>： <code>module.rules</code> 允许你在 webpack 配置中指定多个 loader。</p> <h3 id="打包图片"><a href="#打包图片" class="header-anchor">#</a> 打包图片</h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(jpe?g|png|gif)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">&quot;url-loader&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 'file-loader'</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 占位符</span>
          name<span class="token operator">:</span> <span class="token string">&quot;image/[contenthash].[ext]&quot;</span><span class="token punctuation">,</span>
          limit<span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span> <span class="token comment">// 10kb</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>url-loader</code> 与 <code>file-loader</code> 类似, 用于打包文件，不过<code>url-loader</code>会将文件小于<code>limit</code>的值的的图片打包成 base64 格式的文件。base64 格式适合小体积文件打包。</p></blockquote> <p><strong>最佳实践</strong></p> <ul><li>小文件使用 Data URLs, 减少请求次数</li> <li>大文件单独提取存放，提高加载速度</li></ul> <h3 id="打包样式文件"><a href="#打包样式文件" class="header-anchor">#</a> 打包样式文件</h3> <ul><li><strong>style-loader 作用:</strong> 把 CSS 插入到 DOM 中。</li> <li><strong>css-loader 作用</strong> 对 <code>@import</code> 和 <code>url()</code> 进行处理，就像 js 解析 <code>import/require()</code> 一样， 把多个 css 文件合并成一个</li> <li><strong>sass-loader 作用</strong> 把 sass 文件翻译成 css</li> <li><strong>postcss-loader</strong> 用来自动添加 css 浏览器商家前缀，可在<code>post.config.js</code>中进行配置</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.scss$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;style-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          loader<span class="token operator">:</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">,</span>
          options<span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 处理scss文件里引入其他scss文件，引入的scss文件也要走两个loader</span>
            importLoaders<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token comment">// 是否开启css module打包</span>
            modules<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">&quot;sass-loader&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;postcss-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在<a href="https://webpack.docschina.org/loaders/css-loader/" target="_blank" rel="noopener noreferrer">css-loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的<code>options</code>将<code>module</code>设置成<code>true</code>,可以使用<code>CSS Modules</code>组织样式，避免 css 全局污染, <code>CSS Modules</code>使用方式如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> style <span class="token keyword">from</span> <span class="token string">&quot;./style/index.scss&quot;</span><span class="token punctuation">;</span>
</code></pre></div><blockquote><p>注：use 数组里编译的顺序是从后往前执行，如果不注意先后顺序打包时可能会报错</p></blockquote> <h3 id="打包-es2015-文件"><a href="#打包-es2015-文件" class="header-anchor">#</a> 打包 ES2015 文件</h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Webpack 只是打包工具，因为模块打包需要，所以处理 import 和 export，但是没有对其他 ES2015 新特性进行编译，所以要为 js 配置额外的编译型 loader，例如 <code>babel-loader</code>。</p> <h3 id="打包-iconfont-文件"><a href="#打包-iconfont-文件" class="header-anchor">#</a> 打包 iconfont 文件</h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(eot|ttf|svg)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> <span class="token string">&quot;file-loader&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><img src="/engineering/webpack_static.png" alt=""></p> <p>webpack 鼓励根据代码需要动态导入资源，根据当前的代码加载需要的资源。使用 JavaScript 驱动前端应用，而在实现业务功能的过程当中可能需要图片、样式等等的资源文件，这样就建立了一种依赖关系。</p> <h3 id="常用-loader-分类"><a href="#常用-loader-分类" class="header-anchor">#</a> 常用 loader 分类</h3> <ul><li>编译转换类 （css-loader）</li> <li>文件操作类 (file-loader: 把加载到文件拷贝到输出目录，同时导出文件的访问路径)</li> <li>代码检查类（eslint-loader）</li></ul> <p>更多文件格式的参考 <a href="https://webpack.docschina.org/loaders/" target="_blank" rel="noopener noreferrer">loader<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="plugins"><a href="#plugins" class="header-anchor">#</a> plugins</h2> <p><code>plugin</code>可以在 webpack 运行到某个节点，帮我们实现前端大多自动工程化工作，<code>plugin</code>目的在于解决 loader 无法实现的其他事。</p> <p>由于 webpack 的 plugin 选项过于强大，从而使得刚接触 webpack 的人就误以为 webpack 就是前端工程化工具。</p> <h3 id="htmlwebpackplugin"><a href="#htmlwebpackplugin" class="header-anchor">#</a> HtmlWebpackPlugin</h3> <p><code>HtmlWebpackPlugin</code> 会在打包结束后自动生成一个 html 文件，并把打包生成 js 自动引入到这个 html 文件中, 在文件被打包之后执行</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token string">&quot;index.js&quot;</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;bundle.js&quot;</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;dist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// publicPath: 'dist/'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 用于生成 index.html</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token operator">:</span> <span class="token string">&quot;Webpack Plugin Sample&quot;</span><span class="token punctuation">,</span>
      meta<span class="token operator">:</span> <span class="token punctuation">{</span>
        viewport<span class="token operator">:</span> <span class="token string">&quot;width=device-width&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 设置模版html</span>
      template<span class="token operator">:</span> <span class="token string">&quot;./src/index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 用于生成多个页面文件 about.html</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token operator">:</span> <span class="token string">&quot;about.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="cleanwebpackplugin"><a href="#cleanwebpackplugin" class="header-anchor">#</a> CleanWebpackPlugin</h3> <p><code>CleanWebpackPlugin</code> 在打包之前，帮你清理删除某个文件夹</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;dist&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>更多插件参考 <a href="https://webpack.docschina.org/plugins/" target="_blank" rel="noopener noreferrer">plugin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="minicssextractplugin"><a href="#minicssextractplugin" class="header-anchor">#</a> MiniCssExtractPlugin</h3> <p><code>MiniCssExtractPlugin</code>可以将 css 提取为一个单独的文件，一般当 css 文件超过 150kb 才需要考虑是否将 css 提取。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.css$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
      use<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;MiniCssExtractPlugin.loader&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;css-loader&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="optimizecssassetswebpackplugin"><a href="#optimizecssassetswebpackplugin" class="header-anchor">#</a> OptimizeCssAssetsWebpackPlugin</h3> <p><code>OptimizeCssAssetsWebpackPlugin</code>是压缩 css 的插件，将这个插件放在<code>optimization</code>的<code>minimizer</code>的数组里，只有在 <code>minimizer</code> 的特性开启时才工作，如果放在<code>plugins</code>中任何时候都工作。</p> <div class="language-js extra-class"><pre class="language-js"><code>optimization<span class="token operator">:</span> <span class="token punctuation">{</span>
  minimizer<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token comment">// 内置的js压缩插件</span>
    <span class="token keyword">new</span> <span class="token class-name">TerserWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">OptimizeCssAssetsWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="copywebpackplugin"><a href="#copywebpackplugin" class="header-anchor">#</a> CopyWebpackPlugin</h3> <p>将文件拷贝到输出的目录中</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token comment">// 'public/**'</span>
    <span class="token string">&quot;public&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="defineplugin"><a href="#defineplugin" class="header-anchor">#</a> DefinePlugin</h3> <p>为代码注入全局成员,用来注入代码中可能发生变化的值</p> <div class="language-js extra-class"><pre class="language-js"><code>plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// 值要求的是一个代码片段</span>
    <span class="token constant">API_BASE_URL</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">&quot;https://api.example.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="entry-output"><a href="#entry-output" class="header-anchor">#</a> entry &amp; output</h2> <p>打包的入口起点和输出， 即使可以存在多个 <code>entry</code> 起点，但只能指定一个 <code>output</code> 配置</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    app<span class="token operator">:</span> <span class="token string">&quot;./src/app.js&quot;</span><span class="token punctuation">,</span>
    search<span class="token operator">:</span> <span class="token string">&quot;./src/search.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;[name].js&quot;</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> __dirname <span class="token operator">+</span> <span class="token string">&quot;/dist&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 需要是绝对路径</span>
    publicPath<span class="token operator">:</span> <span class="token string">&quot;http://cdn.com.cn&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 写入到硬盘：./dist/app.js, ./dist/search.js</span>
</code></pre></div><p><code>publicPath</code> 用于指定外部资源（如图片、文件等）的路径，支持文件路径使用 cdn 地址</p> <h2 id="devtool"><a href="#devtool" class="header-anchor">#</a> Devtool</h2> <p><code>sourceMap</code>可以将打包后的代码与原代码做具体到行和列的映射(mapping),从而便于开发者查询问题和 debug, <code>Devtool</code>属性可以选择生成<code>sourceMap</code>的方式</p> <p><code>sourceMap</code>有多种生成模式，各种模式可以自由组合，来满足各种环境下的需求 模式是<code>[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map</code></p> <ul><li><code>inline-</code> source map 转换为 DataUrl 后添加到 bundle 中</li> <li><code>clean-</code> 没有列映射(column mapping)的 source map，可以提升构建速度</li> <li><code>eval-</code> 每个模块使用 eval() 执行，并且 source map 转换为 DataUrl 后添加到 eval() 中</li> <li><code>module-</code> 打包出没有经过<code>loader</code>加工手写的源代码，打包出的效果更好</li></ul> <h3 id="最佳实践"><a href="#最佳实践" class="header-anchor">#</a> 最佳实践</h3> <ul><li>开发环境下 <code>development</code>使用 <code>cheap-module-eval-source-map</code>，可以兼顾打包效率和精确度
<ul><li>我们的代码每行不会超过 80 个字符</li> <li>我的代码经过 loader 转换后差异较大</li> <li>首次打包速度慢无所谓，重写打包相对较快</li></ul></li> <li>生产环境下 <code>production</code> 使用 <code>cheap-module-source-map</code>提升精确度， 或者为<code>none</code>不暴露 sourcemap</li></ul> <ul><li><a href="https://github.com/licop/What_is_FE/tree/master/examples/webpack-demo/22-devtool-diff" target="_blank" rel="noopener noreferrer">不同 source 打包对比 demo<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.docschina.org/configuration/devtool/" target="_blank" rel="noopener noreferrer">更多关于 devtool 内容参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="devserver"><a href="#devserver" class="header-anchor">#</a> devServer</h2> <p>在每次编译代码时，手动运行 <code>npm run build</code> 会显得很麻烦。</p> <p><code>webpack-dev-server</code>会开启一个服务器，打开一个端口，可以帮助你在代码发生变化后<strong>自动编译代码</strong>和<strong>自动刷新浏览器</strong>。</p> <p>webpack 没有提供自带的工具，我们需要自己安装</p> <div class="language- extra-class"><pre class="language-text"><code>  npm install --save-dev webpack-dev-server
</code></pre></div><p>以下配置告知 <code>webpack-dev-server</code>，将 dist 目录下的文件 serve 到 localhost:9000 下。</p> <div class="language-js extra-class"><pre class="language-js"><code>   devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
		contentBase<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		compress<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
		port<span class="token operator">:</span> <span class="token number">9000</span><span class="token punctuation">,</span>
		open<span class="token operator">:</span> <span class="token boolean">true</span>
	<span class="token punctuation">}</span>
</code></pre></div><h3 id="devserver-静态资源访问"><a href="#devserver-静态资源访问" class="header-anchor">#</a> devServer 静态资源访问</h3> <p><code>contentBase</code>可以额外为开发服务器指定查找资源目录</p> <h3 id="转发代理"><a href="#转发代理" class="header-anchor">#</a> 转发代理</h3> <p>当拥有单独的 API 后端开发服务器并且希望在同一域上发送 API 请求时，我们可以使用<code>webpack-dev-server</code>对请求转发进行代理。</p> <p>使用后端在 <code>localhost:3000</code> 上，可以使用它来启用代理</p> <p>现在，对 <code>/api/users</code> 的请求会将请求代理到 <code>http://localhost:3000/api/users</code>。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;/api&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://localhost:3000&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>将请求<code>/api/users</code>代理到 https://api.github.com/users</p> <div class="language-js extra-class"><pre class="language-js"><code>devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    contentBase<span class="token operator">:</span> <span class="token string">'./public'</span><span class="token punctuation">,</span>
    proxy<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string">'/api'</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// http://localhost:8080/api/users -&gt; https://api.github.com/api/users</span>
        target<span class="token operator">:</span> <span class="token string">'https://api.github.com'</span><span class="token punctuation">,</span>
        <span class="token comment">// http://localhost:8080/api/users -&gt; https://api.github.com/users</span>
        pathRewrite<span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token string">'^/api'</span><span class="token operator">:</span> <span class="token string">''</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 不能使用 localhost:8080 作为请求 GitHub 的主机名</span>
        changeOrigin<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="实现一个简易的-webpackserver"><a href="#实现一个简易的-webpackserver" class="header-anchor">#</a> 实现一个简易的 webpackserver</h3> <p>同样我们可以使用<code>webpack-dev-middleware</code>和<code>express</code>来自己编写一个，简单的<code>webpack-dev-server</code>。</p> <p>新建一个 <code>server.js</code>文件，然后执行<code>node server.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;express&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> webpackDevMiddleware <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;webpack-dev-middleware&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./webpack.config.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 告知 express 使用 webpack-dev-middleware，</span>
<span class="token comment">// 以及将 webpack.config.js 配置文件作为基础配置。</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">webpackDevMiddleware</span><span class="token punctuation">(</span>compiler<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    publicPath<span class="token operator">:</span> config<span class="token punctuation">.</span>output<span class="token punctuation">.</span>publicPath<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将文件 serve 到 port 3000。</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Example app listening on port 3000!\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>更多 <a href="https://webpack.docschina.org/configuration/dev-server/" target="_blank" rel="noopener noreferrer">webpack-dev-server 配置<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 参考</p> <h2 id="解析-resolve"><a href="#解析-resolve" class="header-anchor">#</a> 解析 resolve</h2> <p>这些选项能设置模块如何被解析。webpack 提供合理的默认值，但是还是可能会修改一些解析的细节。</p> <p><code>resolve.alias</code>为 reslove 常用属性。创建 import 或 require 的别名，来确保模块引入变得更简单</p> <p>例如，一些位于 src/ 文件夹下的常用模块：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      Utilities<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src/utilities/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      Templates<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src/templates/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>可以这样使用别名</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Utility <span class="token keyword">from</span> <span class="token string">&quot;Utilities/utility&quot;</span><span class="token punctuation">;</span>
</code></pre></div><p><a href="https://webpack.docschina.org/configuration/resolve/" target="_blank" rel="noopener noreferrer">更多 resolve 参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="热模块替换-hmr"><a href="#热模块替换-hmr" class="header-anchor">#</a> 热模块替换 HMR</h2> <p><strong>模块热替换(HMR - Hot Module Replacement)</strong> 功能会在应用程序运行过程中，替换、添加或删除模块，而无需重新加载整个页面,不用担心页面整体自动刷新而导致页面状态丢失。</p> <h3 id="hmr-作用"><a href="#hmr-作用" class="header-anchor">#</a> HMR 作用</h3> <ul><li>保留在完全重新加载页面期间丢失的应用程序状态。</li> <li>只更新变更内容，以节省宝贵的开发时间。</li> <li>在源代码中 CSS/JS 产生修改时，会立刻在浏览器中进行更新，这几乎相当于在浏览器 devtools 直接更改样式。</li></ul> <h3 id="hmr-使用"><a href="#hmr-使用" class="header-anchor">#</a> HMR 使用</h3> <p>HMR 集成在 webpack-dev-server 中，可以通过 <code>webpack-dev-server --hot</code> 开启这个特性，或者可以在配置文件中添加对应的配置</p> <div class="language-js extra-class"><pre class="language-js"><code>devServer<span class="token operator">:</span> <span class="token punctuation">{</span>
  contentBase<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span> <span class="token number">9000</span><span class="token punctuation">,</span>
  open<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

  hot<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  hotOnly<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 只使用 HMR，不会 fallback 到 live reloading</span>
<span class="token punctuation">}</span>
</code></pre></div><p>当更新 css 文件时，<code>style-loader</code>帮我们自动完成了热替换；当它通过 HMR 接收到更新，它会使用新的样式替换旧的样式。</p> <p>当更新 js 文件时，Webpack 中的 HMR 需要手动处理模块热替换逻辑，可以在 js 文件中添加如下方法，实现某个模块的热替换。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用HMR API</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">&quot;./print.js&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">printMe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>通用脚手架创建的项目内部都集成了 HMR 方案，不需要自己手动处理。</p> <ul><li><a href="https://webpack.docschina.org/concepts/hot-module-replacement/" target="_blank" rel="noopener noreferrer">模块热替换(hot module replacement)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://webpack.docschina.org/api/hot-module-replacement/" target="_blank" rel="noopener noreferrer">Hot Module Replacement API<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="babel"><a href="#babel" class="header-anchor">#</a> babel</h2> <p>使用<code>babel</code>对 js 文件进行转化，是的 ES6 语法变成各个浏览器能够识别的语法</p> <p>webpack 引入<code>babel-loader</code>, 并且新建<code>.babelrc</code>文件对 babel 进行配置</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token operator">:</span> <span class="token punctuation">{</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果对 react 项目进行打包，需用使用<code>@babel/preset-react</code>对文件进行处理，是的<code>jsx</code>格式语法能够被翻译</p> <p>更多参考<a href="https://babeljs.io/setup#installation" target="_blank" rel="noopener noreferrer">babel 文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/engineering/前端工程化/自动化构建.html" class="prev">
        自动化构建
      </a></span> <span class="next"><a href="/engineering/webpack/webpack高级概念.html">
        webpack 高级概念
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.23d3122b.js" defer></script><script src="/assets/js/2.5e2d37c1.js" defer></script><script src="/assets/js/23.9da4a7d3.js" defer></script><script src="/assets/js/3.b304fdc1.js" defer></script>
  </body>
</html>
