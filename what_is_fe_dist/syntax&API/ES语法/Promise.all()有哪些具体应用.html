<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Promise.all()有哪些具体应用 | What is FE</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="构建自己的系统的 Web 前端知识体系">
    
    <link rel="preload" href="/assets/css/0.styles.41761744.css" as="style"><link rel="preload" href="/assets/js/app.c5777987.js" as="script"><link rel="preload" href="/assets/js/2.5e2d37c1.js" as="script"><link rel="preload" href="/assets/js/39.7464134f.js" as="script"><link rel="preload" href="/assets/js/3.b304fdc1.js" as="script"><link rel="prefetch" href="/assets/js/10.9fc866c3.js"><link rel="prefetch" href="/assets/js/11.6cec0877.js"><link rel="prefetch" href="/assets/js/12.5b161d54.js"><link rel="prefetch" href="/assets/js/13.643edb99.js"><link rel="prefetch" href="/assets/js/14.6bac40a6.js"><link rel="prefetch" href="/assets/js/15.61d3cd46.js"><link rel="prefetch" href="/assets/js/16.e1e700c5.js"><link rel="prefetch" href="/assets/js/17.883eaf2e.js"><link rel="prefetch" href="/assets/js/18.183c1e46.js"><link rel="prefetch" href="/assets/js/19.02533cd2.js"><link rel="prefetch" href="/assets/js/20.e927c48f.js"><link rel="prefetch" href="/assets/js/21.601eec8f.js"><link rel="prefetch" href="/assets/js/22.e6ce73ac.js"><link rel="prefetch" href="/assets/js/23.0a0d000d.js"><link rel="prefetch" href="/assets/js/24.68f17417.js"><link rel="prefetch" href="/assets/js/25.d352497d.js"><link rel="prefetch" href="/assets/js/26.31f6158b.js"><link rel="prefetch" href="/assets/js/27.a07cb107.js"><link rel="prefetch" href="/assets/js/28.d75b3738.js"><link rel="prefetch" href="/assets/js/29.2cb21908.js"><link rel="prefetch" href="/assets/js/30.ef8672b5.js"><link rel="prefetch" href="/assets/js/31.85fde811.js"><link rel="prefetch" href="/assets/js/32.c664d318.js"><link rel="prefetch" href="/assets/js/33.c2fb006b.js"><link rel="prefetch" href="/assets/js/34.246653c2.js"><link rel="prefetch" href="/assets/js/35.5f801f03.js"><link rel="prefetch" href="/assets/js/36.6f895472.js"><link rel="prefetch" href="/assets/js/37.17d3f030.js"><link rel="prefetch" href="/assets/js/38.2b3ab31a.js"><link rel="prefetch" href="/assets/js/4.d9a2acfb.js"><link rel="prefetch" href="/assets/js/40.4488b337.js"><link rel="prefetch" href="/assets/js/41.7e0bdd3c.js"><link rel="prefetch" href="/assets/js/42.860aab70.js"><link rel="prefetch" href="/assets/js/43.be386e56.js"><link rel="prefetch" href="/assets/js/44.6415e439.js"><link rel="prefetch" href="/assets/js/45.8c27fb44.js"><link rel="prefetch" href="/assets/js/46.ea162f6d.js"><link rel="prefetch" href="/assets/js/47.26a59269.js"><link rel="prefetch" href="/assets/js/48.19d57a0c.js"><link rel="prefetch" href="/assets/js/49.783c2463.js"><link rel="prefetch" href="/assets/js/5.a6acc31c.js"><link rel="prefetch" href="/assets/js/50.3a14c00d.js"><link rel="prefetch" href="/assets/js/51.a947c12c.js"><link rel="prefetch" href="/assets/js/52.70ef83b3.js"><link rel="prefetch" href="/assets/js/53.14cc1365.js"><link rel="prefetch" href="/assets/js/54.ceaf84a1.js"><link rel="prefetch" href="/assets/js/55.1ba37dcb.js"><link rel="prefetch" href="/assets/js/6.56200eb6.js"><link rel="prefetch" href="/assets/js/7.ab8ffd39.js"><link rel="prefetch" href="/assets/js/8.f847aa7a.js"><link rel="prefetch" href="/assets/js/9.ad553fba.js">
    <link rel="stylesheet" href="/assets/css/0.styles.41761744.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">What is FE</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/programming-basics/编程模式/函数式编程.html" class="nav-link">
  编程基础
</a></div><div class="nav-item"><a href="/syntax&amp;API/HTML/关于HTML.html" class="nav-link">
  语法和API
</a></div><div class="nav-item"><a href="/network/" class="nav-link">
  网络和通讯
</a></div><div class="nav-item"><a href="/development-process/Git/git命令.html" class="nav-link">
  开发流程
</a></div><div class="nav-item"><a href="/engineering/webpack/webpack基础学习.html" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/runnnig-monitoring/安全/CSRF.html" class="nav-link">
  运行与监控
</a></div><div class="nav-item"><a href="/framework/React/关于react-hook.html" class="nav-link">
  前端框架
</a></div><div class="nav-item"><a href="/tool&amp;plugin/cross-env/关于cross-env.html" class="nav-link">
  常用工具与插件
</a></div><div class="nav-item"><a href="/server/" class="nav-link">
  服务器端
</a></div><div class="nav-item"><a href="/more/" class="nav-link">
  技术广度
</a></div><div class="nav-item"><a href="https://github.com/licop/What_is_FE" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/programming-basics/编程模式/函数式编程.html" class="nav-link">
  编程基础
</a></div><div class="nav-item"><a href="/syntax&amp;API/HTML/关于HTML.html" class="nav-link">
  语法和API
</a></div><div class="nav-item"><a href="/network/" class="nav-link">
  网络和通讯
</a></div><div class="nav-item"><a href="/development-process/Git/git命令.html" class="nav-link">
  开发流程
</a></div><div class="nav-item"><a href="/engineering/webpack/webpack基础学习.html" class="nav-link">
  前端工程化
</a></div><div class="nav-item"><a href="/runnnig-monitoring/安全/CSRF.html" class="nav-link">
  运行与监控
</a></div><div class="nav-item"><a href="/framework/React/关于react-hook.html" class="nav-link">
  前端框架
</a></div><div class="nav-item"><a href="/tool&amp;plugin/cross-env/关于cross-env.html" class="nav-link">
  常用工具与插件
</a></div><div class="nav-item"><a href="/server/" class="nav-link">
  服务器端
</a></div><div class="nav-item"><a href="/more/" class="nav-link">
  技术广度
</a></div><div class="nav-item"><a href="https://github.com/licop/What_is_FE" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>HTML</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/syntax&amp;API/HTML/关于HTML.html" class="sidebar-link">关于 HTML</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/syntax&amp;API/CSS/css单位中px和em,rem的区别.html" class="sidebar-link">css 单位中 px 和 em,rem 的区别</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ES语法</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/syntax&amp;API/ES语法/ECMAScript 2015 语法.html" class="sidebar-link">ECMAScript 2015 语法</a></li><li><a href="/syntax&amp;API/ES语法/Javascript异步编程.html" class="sidebar-link">Javascript 异步编程</a></li><li><a href="/syntax&amp;API/ES语法/promise源码实现.html" class="sidebar-link">Promise 源码实现</a></li><li><a href="/syntax&amp;API/ES语法/Promise.all()有哪些具体应用.html" class="active sidebar-link">Promise.all()有哪些具体应用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/syntax&amp;API/ES语法/Promise.all()有哪些具体应用.html#参数" class="sidebar-link">参数</a></li><li class="sidebar-sub-header"><a href="/syntax&amp;API/ES语法/Promise.all()有哪些具体应用.html#实现-promise-all" class="sidebar-link">实现 promise.all</a></li><li class="sidebar-sub-header"><a href="/syntax&amp;API/ES语法/Promise.all()有哪些具体应用.html#应用场景-1-多个请求结果合并在一起" class="sidebar-link">应用场景 1：多个请求结果合并在一起</a></li><li class="sidebar-sub-header"><a href="/syntax&amp;API/ES语法/Promise.all()有哪些具体应用.html#应用场景-2-合并请求结果并处理错误" class="sidebar-link">应用场景 2：合并请求结果并处理错误</a></li><li class="sidebar-sub-header"><a href="/syntax&amp;API/ES语法/Promise.all()有哪些具体应用.html#应用场景-3-验证多个请求结果是否都是满足条件" class="sidebar-link">应用场景 3：验证多个请求结果是否都是满足条件</a></li></ul></li><li><a href="/syntax&amp;API/ES语法/Promise.race()有哪些具体应用.html" class="sidebar-link">Promise.race()有哪些具体应用</a></li><li><a href="/syntax&amp;API/ES语法/JavaScript类型系统.html" class="sidebar-link">JavaScript 类型系统</a></li><li><a href="/syntax&amp;API/ES语法/JS值类型和引用类型.html" class="sidebar-link">JS 值类型和引用类型</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Typescript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/syntax&amp;API/Typescript/introduction.html" class="sidebar-link">初识 TypeScript</a></li><li><a href="/syntax&amp;API/Typescript/install.html" class="sidebar-link">安装</a></li><li><a href="/syntax&amp;API/Typescript/type.html" class="sidebar-link">基础类型</a></li><li><a href="/syntax&amp;API/Typescript/declare.html" class="sidebar-link">变量声明</a></li><li><a href="/syntax&amp;API/Typescript/interface.html" class="sidebar-link">接口</a></li><li><a href="/syntax&amp;API/Typescript/class.html" class="sidebar-link">类</a></li><li><a href="/syntax&amp;API/Typescript/function.html" class="sidebar-link">函数</a></li><li><a href="/syntax&amp;API/Typescript/generic.html" class="sidebar-link">泛型</a></li><li><a href="/syntax&amp;API/Typescript/inference.html" class="sidebar-link">类型推断</a></li><li><a href="/syntax&amp;API/Typescript/advance.html" class="sidebar-link">高级类型</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Flow</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/syntax&amp;API/Flow/关于Flow.html" class="sidebar-link">关于 Flow</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="promise-all-有哪些具体应用"><a href="#promise-all-有哪些具体应用" class="header-anchor">#</a> Promise.all()有哪些具体应用</h1> <p><strong>Promise.all(iterable)</strong> 方法返回一个 Promise 实例，此实例在 iterable 参数内所有的 promise 都“完成（resolved）”或参数中不包含 promise 时回调完成（resolve）；如果参数中 promise 有一个失败（rejected），此实例回调失败（reject），失败的原因是第一个失败 promise 的结果。</p> <p>它通常在启动多个异步任务<strong>并发运行</strong>并为其结果创建承诺之后使用，以便人们可以等待所有任务完成。</p> <h2 id="参数"><a href="#参数" class="header-anchor">#</a> 参数</h2> <p><strong>iterable:</strong> 一个可迭代的对象，比如<strong>Array</strong>和<strong>String</strong></p> <h2 id="实现-promise-all"><a href="#实现-promise-all" class="header-anchor">#</a> 实现 promise.all</h2> <p><strong>核心思路</strong></p> <ul><li>接收一个 Promise 实例的数组或具有 Iterator 接口的对象作为参数</li> <li>这个方法返回一个新的 promise 对象，</li> <li>遍历传入的参数，用 Promise.resolve()将参数&quot;包一层&quot;，使其变成一个 promise 对象</li> <li>参数所有回调成功才是成功，返回值数组与参数顺序一致</li> <li>参数数组其中一个失败，则触发失败状态，第一个触发失败的 Promise 错误信息作为 Promise.all 的错误信息。</li></ul> <div class="language- extra-class"><pre class="language-text"><code>  // 实现promise.all
function promiseAll(promises) {
    return new Promise((resolve, reject) =&gt; {
        if(!Array.isArray(promises)) {
            throw new TypeError(`argument must be a array`)
        }
        let result = [];
        let count = 0;
        for(let i = 0; i &lt; promises.length; i++) {
            Promise.resolve(promises[i]).then((value) =&gt; {
                count++
                result[i] = value;
                if(count === promises.length) {
                    resolve(result)
                }
            }, (error) =&gt; {
                return reject(error)
            })
        }
    })
}
</code></pre></div><h2 id="应用场景-1-多个请求结果合并在一起"><a href="#应用场景-1-多个请求结果合并在一起" class="header-anchor">#</a> 应用场景 1：多个请求结果合并在一起</h2> <blockquote><p>具体描述：一个页面，有多个请求，我们需求所有的请求都返回数据后再一起处理渲染</p></blockquote> <p>思考：如果并发请求的话，每个请求的 loading 状态要单独设置，多个的话可能多个 loading 重合，页面显示的内容 根据请求返回数据的快慢 有所差异，具体表现在渲染的过程，为提升用户体验，我们可以采用 所有请求返回数据后，再一起渲染，此时我们关闭请求的单独 loading 设置，通过 Promise.all 汇总请求结果，从开始到结束，我们只设置一个 loading 即可</p> <div class="language- extra-class"><pre class="language-text"><code>   //1.获取轮播数据列表
function getBannerList(){
    return new Promise((resolve,reject)=&gt;{
        setTimeout(function(){
            resolve('轮播数据')
        },300)
    })
}

//2.获取店铺列表
function getStoreList(){
   return new Promise((resolve,reject)=&gt;{
        setTimeout(function(){
            resolve('店铺数据')
        },500)
    })
}

//3.获取分类列表
function getCategoryList(){
   return new Promise((resolve,reject)=&gt;{
        setTimeout(function(){
            resolve('分类数据')
        },700)
    })
}

function initLoad() {
      // loading.show() //加载loading
    Promise.all([getBannerList(),getStoreList(),getCategoryList()]).then(res=&gt;{
        console.log(res)
        // loading.hide() //关闭loading
    }).catch(err=&gt;{
        console.log(err)
        // loading.hide()//关闭loading
    })
}

//数据初始化
initLoad()
</code></pre></div><h2 id="应用场景-2-合并请求结果并处理错误"><a href="#应用场景-2-合并请求结果并处理错误" class="header-anchor">#</a> 应用场景 2：合并请求结果并处理错误</h2> <blockquote><p>描述：我们需求单独处理一个请求的数据渲染和错误处理逻辑，有多个请求，我们就需要在多个地方写</p></blockquote> <p>思考：我们能否把多个请求合并在一起，哪怕有的请求失败了，也返回给我们，我们只需要在一个地方处理这些数据和错误的逻辑即可。</p> <div class="language- extra-class"><pre class="language-text"><code>   //1.获取轮播图数据列表
function getBannerList(){
    return new Promise((resolve,reject)=&gt;{
        setTimeout(function(){
            // resolve('轮播图数据')
            reject('获取轮播图数据失败啦')
        },300)
    })
}

//2.获取店铺列表
function getStoreList(){
   return new Promise((resolve,reject)=&gt;{
        setTimeout(function(){
            resolve('店铺数据')
        },500)
    })
}

//3.获取分类列表
function getCategoryList(){
    return new Promise((resolve,reject)=&gt;{
        setTimeout(function(){
            resolve('分类数据')
        },700)
    })
}

function initLoad(){
    // loading.show()
    Promise.all([
        getBannerList().catch(err=&gt;err),
        getStoreList().catch(err=&gt;err),
        getCategoryList().catch(err=&gt;err)
    ]).then(res=&gt;{
        console.log(res) // [&quot;获取轮播图数据失败啦&quot;, &quot;店铺数据&quot;, &quot;分类数据&quot;]

        if(res[0] == '轮播图数据'){
            //渲染
        }else{
            //获取 轮播图数据 失败的逻辑
        }
        if(res[1] == '店铺数据'){
            //渲染
        }else{
            //获取 店铺列表数据 失败的逻辑
        }
        if(res[2] == '分类数据'){
            //渲染
        }else{
             //获取 分类列表数据 失败的逻辑
        }

        // loading.hide()
    })
}

initLoad()

</code></pre></div><p>有时候页面挂掉了，可能因为接口异常导致，或许只是一个无关紧要的接口挂掉了。那么一个接口挂掉了为什么会导致整个页面无数据呢？Promise.all 告诉我们，如果参数中 promise 有一个失败（rejected），此实例回调失败（reject），就不再执行 then 方法回调，以上用例 正好可以解决此种问题</p> <h2 id="应用场景-3-验证多个请求结果是否都是满足条件"><a href="#应用场景-3-验证多个请求结果是否都是满足条件" class="header-anchor">#</a> 应用场景 3：验证多个请求结果是否都是满足条件</h2> <blockquote><p>描述：在一个微信小程序项目中，做一个表单的输入内容安全验证，调用的是云函数写的方法，表单有多 7 个字段需要验证，都是调用的一个 内容安全校验接口，全部验证通过则 可以 进行正常的提交</p></blockquote> <div class="language- extra-class"><pre class="language-text"><code>  function verify1(content){
    return new Promise((resolve,reject)=&gt;{
        setTimeout(function(){
            resolve(true)
        },200)
    })
}

function verify2(content){
    return new Promise((resolve,reject)=&gt;{
        setTimeout(function(){
            resolve(true)
        },700)
    })
}

function verify3(content){
    return new Promise((resolve,reject)=&gt;{
        setTimeout(function(){
            resolve(true)
        },300)
    })
}

Promise.all([verify1('校验字段1的内容'),verify2('校验字段2的内容'),verify3('校验字段3的内容')]).then(result=&gt;{
    console.log(result)//[true, true, true]

    let verifyResult = result.every(item=&gt;item)
    //验证结果
    console.log(verifyResult?'通过验证':'未通过验证')// 通过验证
}).catch(err=&gt;{
    console.log(err)
})

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/syntax&amp;API/ES语法/promise源码实现.html" class="prev">
        Promise 源码实现
      </a></span> <span class="next"><a href="/syntax&amp;API/ES语法/Promise.race()有哪些具体应用.html">
        Promise.race()有哪些具体应用
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.c5777987.js" defer></script><script src="/assets/js/2.5e2d37c1.js" defer></script><script src="/assets/js/39.7464134f.js" defer></script><script src="/assets/js/3.b304fdc1.js" defer></script>
  </body>
</html>
