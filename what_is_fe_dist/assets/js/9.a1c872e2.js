(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{376:function(a,t,e){"use strict";e.r(t);var s=e(27),r=Object(s.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"ci-cd-以及-travis-的使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ci-cd-以及-travis-的使用"}},[a._v("#")]),a._v(" CI/CD 以及 travis 的使用")]),a._v(" "),e("h2",{attrs:{id:"ci-持续集成-continuous-integration"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ci-持续集成-continuous-integration"}},[a._v("#")]),a._v(" CI 持续集成（Continuous Integration）")]),a._v(" "),e("p",[a._v('持续集成指的是只要代码有变更，就自动运行构建和测试，反馈运行结果。确保符合预期以后，再将新代码"集成"到主干。')]),a._v(" "),e("p",[a._v("持续集成的好处在于，每次代码的小幅变更，就能看到运行结果，从而不断累积小的变更，而不是在开发周期结束时，一下子合并一大块代码。")]),a._v(" "),e("ul",[e("li",[a._v("频繁的将代码集成到主干")]),a._v(" "),e("li",[a._v("快速发现错误")]),a._v(" "),e("li",[a._v("防止分支大幅偏离主干")])]),a._v(" "),e("h2",{attrs:{id:"cd-持续交付、持续部署-continuous-delivery-continuous-deployment"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#cd-持续交付、持续部署-continuous-delivery-continuous-deployment"}},[a._v("#")]),a._v(" CD 持续交付、持续部署(Continuous Delivery & Continuous Deployment)")]),a._v(" "),e("ul",[e("li",[a._v("频繁的将软件的新版本，交付给质量团队或者用户")]),a._v(" "),e("li",[a._v("代码通过评审以后，自动部署到生产环境")])]),a._v(" "),e("p",[e("img",{attrs:{src:"/cicd.png",alt:"cicd"}})]),a._v(" "),e("h2",{attrs:{id:"使用-travis-ci"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用-travis-ci"}},[a._v("#")]),a._v(" 使用 Travis CI")]),a._v(" "),e("p",[e("code",[a._v("Travis CI")]),a._v(" 提供的是持续集成服务（CI）。它绑定 Github 上面的项目，只要有新的代码，就会自动抓取。然后，提供一个运行环境，执行测试，完成构建，还能部署到"),e("a",{attrs:{href:"https://docs.travis-ci.com/user/deployment/pages/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Gihub Page"),e("OutboundLink")],1),a._v("和服务器上。")]),a._v(" "),e("p",[a._v("如何是 node 项目， "),e("code",[a._v("Travis CI")]),a._v("会首先 自动执行 "),e("code",[a._v("nvm install stable")]),a._v(" 安装依赖,之后执行 "),e("code",[a._v("npm run test")]),a._v("，单元检测全部通过后才会对项目进行构建和部署。")]),a._v(" "),e("blockquote",[e("p",[e("code",[a._v("Travis CI")]),a._v(" 只支持 Github，不支持其他代码托管服务。")])]),a._v(" "),e("h2",{attrs:{id:"travis-yml"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#travis-yml"}},[a._v("#")]),a._v(" .travis.yml")]),a._v(" "),e("p",[a._v("Travis 要求项目的根目录下面，必须有一个"),e("code",[a._v(".travis.yml")]),a._v("文件。这是配置文件，指定了 Travis 的行为。该文件必须保存在 Github 仓库里面，一旦代码仓库有新的 Commit，Travis 就会去找这个文件，执行里面的命令。")]),a._v(" "),e("h2",{attrs:{id:"运行流程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#运行流程"}},[a._v("#")]),a._v(" 运行流程")]),a._v(" "),e("p",[a._v("Travis 的运行流程很简单，任何项目都会经过两个阶段。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("  install 阶段:  安装依赖\n  script 阶段：运行脚本\n")])])]),e("h3",{attrs:{id:"install-字段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#install-字段"}},[a._v("#")]),a._v(" install 字段")]),a._v(" "),e("p",[e("code",[a._v("install")]),a._v("字段用来指定安装脚本。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("install: ./install-dependencies.sh\n")])])]),e("p",[a._v("如果有多个脚本，可以写成下面的形式。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("install:\n  - command1\n  - command2\n")])])]),e("p",[a._v("上面代码中，如果 command1 失败了，整个构建就会停下来，不再往下进行。")]),a._v(" "),e("p",[a._v("如果不需要安装，即跳过安装阶段，就直接设为"),e("code",[a._v("true")]),a._v("。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("install: true\n")])])]),e("h3",{attrs:{id:"script-字段"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#script-字段"}},[a._v("#")]),a._v(" script 字段")]),a._v(" "),e("p",[e("code",[a._v("script")]),a._v("字段用来指定构建或测试脚本。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("script: bundle exec thor build\n")])])]),e("p",[a._v("如果有多个脚本，可以写成下面的形式。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("script:\n  - command1\n  - command2\n")])])]),e("p",[a._v("注意，"),e("code",[a._v("script")]),a._v("与"),e("code",[a._v("install")]),a._v("不一样，如果"),e("code",[a._v("command1")]),a._v("失败，"),e("code",[a._v("command2")]),a._v("会继续执行。但是，整个构建阶段的状态是失败。")]),a._v(" "),e("p",[a._v("如果"),e("code",[a._v("command2")]),a._v("只有在"),e("code",[a._v("command1")]),a._v("成功后才能执行，就要写成下面这样。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("script: command1 && command2\n")])])]),e("h3",{attrs:{id:"运行实例-node-项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#运行实例-node-项目"}},[a._v("#")]),a._v(" 运行实例：Node 项目")]),a._v(" "),e("p",[a._v("以下是一个 node 项目的运行实例，完成文档构建，然后将项目部署到"),e("code",[a._v("Github Page")]),a._v("上。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v('  language: node_js\n  node_js:\n    - "stable"\n  script:\n    - npm run build-storybook\n  deploy:\n    provider: pages\n    skip_cleanup: true\n    github_token: $github_token\n    local_dir: storybook-static\n    on:\n       branch: main\n')])])]),e("p",[a._v("上面代码中，"),e("code",[a._v("node_js")]),a._v("字段用来指定 Node 版本。")]),a._v(" "),e("p",[a._v("Node 项目的"),e("code",[a._v("install")]),a._v("和"),e("code",[a._v("script")]),a._v("阶段都有默认脚本，可以省略。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v(" install默认值：npm install\n script默认值：npm test\n")])])]),e("p",[e("code",[a._v("github_token")]),a._v(" 在 github 的"),e("code",[a._v("Setting")]),a._v("里生成，然后添加到"),e("code",[a._v("travis")]),a._v("的变量中。")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://docs.travis-ci.com/user/languages/javascript-with-nodejs/",target:"_blank",rel:"noopener noreferrer"}},[a._v("更多关于 javascript 和 nodejs 部署"),e("OutboundLink")],1)]),a._v(" "),e("h2",{attrs:{id:"钩子方法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#钩子方法"}},[a._v("#")]),a._v(" 钩子方法")]),a._v(" "),e("p",[a._v("Travis 为上面这些阶段提供了 7 个钩子。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("   before_install：install 阶段之前执行\n   before_script：script 阶段之前执行\n   after_failure：script 阶段失败时执行\n   after_success：script 阶段成功时执行\n   before_deploy：deploy 步骤之前执行\n   after_deploy：deploy 步骤之后执行\n   after_script：script 阶段之后执行\n")])])]),e("p",[a._v("下面是一个"),e("code",[a._v("before_install")]),a._v("钩子的例子。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("  before_install:\n  - sudo apt-get -qq update\n  - sudo apt-get install -y libxml2-dev\n")])])]),e("p",[a._v("上面代码表示"),e("code",[a._v("before_instal")]),a._v("l 阶段要做两件事，第一件事是要更新依赖，第二件事是安装"),e("code",[a._v("libxml2-dev")])]),a._v(" "),e("h2",{attrs:{id:"运行状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#运行状态"}},[a._v("#")]),a._v(" 运行状态")]),a._v(" "),e("p",[a._v("最后，Travis 每次运行，可能会返回四种状态。")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("   passed：运行成功，所有步骤的退出码都是0\n   canceled：用户取消执行\n   errored：before_install、install、before_script有非零退出码，运行会立即停止\n   failed ：script有非零状态码 ，会继续运行\n")])])]),e("h2",{attrs:{id:"更多参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#更多参考"}},[a._v("#")]),a._v(" 更多参考")]),a._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"http://www.ruanyifeng.com/blog/2017/12/travis_ci_tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("持续集成服务 Travis CI 教程"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://docs.travis-ci.com/user/languages/javascript-with-nodejs/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Building a JavaScript and Node.js project"),e("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);